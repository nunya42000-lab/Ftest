<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevCompanion Pro Suite</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --accent: #58a6ff; --success: #3fb950; --warn: #d29922; --danger: #f85149; --text: #c9d1d9; --border: #30363d; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* Dashboard Layout */
        header { background: var(--panel); padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .main-container { display: grid; grid-template-columns: 300px 1fr; flex: 1; overflow: hidden; }
        @media (max-width: 800px) { .main-container { grid-template-columns: 1fr; } }

        /* Sidebar Tools */
        .sidebar { background: var(--panel); border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }
        .tool-card { background: #000; padding: 15px; border-radius: 8px; border: 1px solid var(--border); cursor: pointer; transition: 0.2s; }
        .tool-card:hover { border-color: var(--accent); }
        .tool-card.active { border-left: 4px solid var(--accent); background: #1c2128; }

        /* Workspace */
        .workspace { padding: 20px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }
        .editor-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 1000px) { .editor-group { grid-template-columns: 1fr; } }
        
        textarea { width: 100%; height: 350px; background: #000; color: #d1d5da; border: 1px solid var(--border); border-radius: 6px; font-family: 'Fira Code', monospace; padding: 12px; box-sizing: border-box; font-size: 13px; resize: none; }
        
        .btn-row { display: flex; gap: 10px; flex-wrap: wrap; }
        button { padding: 12px 20px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--success); color: white; }
        .btn-action { background: var(--accent); color: white; }
        .btn-ghost { background: transparent; color: var(--text); border: 1px solid var(--border); }

        #console { background: #000; border: 1px solid var(--border); padding: 10px; font-family: monospace; font-size: 12px; min-height: 80px; color: #8b949e; overflow-y: auto; }
        .stat-badge { background: #388bfd33; color: var(--accent); padding: 2px 8px; border-radius: 10px; font-size: 11px; }
    </style>
</head>
<body>

<header>
    <div style="font-size: 20px; font-weight: bold;">DevCompanion <span style="font-weight: 200; color: var(--accent);">Pro Suite</span></div>
    <div id="file-stats">No files analyzed</div>
</header>

<div class="main-container">
    <aside class="sidebar">
        <div class="tool-card active" onclick="switchTool('assembler')">
            <strong>Code Assembler</strong>
            <p style="font-size: 11px; margin: 5px 0;">Merge files & fill placeholders</p>
        </div>
        <div class="tool-card" onclick="switchTool('optimizer')">
            <strong>Logic Optimizer</strong>
            <p style="font-size: 11px; margin: 5px 0;">Clean redundancies & refactor</p>
        </div>
        <div class="tool-card" onclick="switchTool('modularizer')">
            <strong>Project Exporter</strong>
            <p style="font-size: 11px; margin: 5px 0;">Create ZIP modules</p>
        </div>
    </aside>

    <main class="workspace">
        <div id="console">System Ready. Paste your Master code to begin optimization.</div>

        <div class="editor-group">
            <div>
                <label style="font-size: 12px; font-weight: bold;">Master / Target File</label>
                <textarea id="input-master" placeholder="Paste your main app file here..."></textarea>
            </div>
            <div>
                <label style="font-size: 12px; font-weight: bold;">Source / Snippets</label>
                <textarea id="input-source" placeholder="Paste snippets or old versions here..."></textarea>
            </div>
        </div>

        <div class="btn-row">
            <button class="btn-primary" onclick="runSuite()">RUN FULL OPTIMIZATION</button>
            <button class="btn-action" onclick="refactorLogic()">SMART REFACTOR</button>
            <button class="btn-ghost" onclick="downloadProject()">EXPORT AS ZIP</button>
            <button class="btn-ghost" style="color:var(--danger)" onclick="clearAll()">CLEAR ALL</button>
        </div>

        <label style="font-size: 12px; font-weight: bold;">Optimized Output</label>
        <textarea id="output-final" style="height: 400px;" readonly></textarea>
    </main>
</div>

<script>
    let currentModules = [];

    function log(msg, type = 'info') {
        const con = document.getElementById('console');
        const color = type === 'warn' ? 'var(--warn)' : type === 'success' ? 'var(--success)' : '#8b949e';
        con.innerHTML = `<span style="color:${color}">[${new Date().toLocaleTimeString()}] ${msg}</span><br>` + con.innerHTML;
    }

    function runSuite() {
        log("Starting full assembly and deduplication...", "info");
        const master = document.getElementById('input-master').value;
        const source = document.getElementById('input-source').value;

        if(!master) return log("Error: Master file is empty", "warn");

        const masterBlocks = parseCode(master);
        const sourceBlocks = parseCode(source);
        let finalCode = master;
        let mergeCount = 0;

        sourceBlocks.forEach(src => {
            const match = masterBlocks.find(m => m.name === src.name);
            if(match && match.isPlaceholder) {
                const regex = new RegExp(`${src.name}\\s*[:=]?\\s*\\(.*?\\)\\s*{[\\s\\S]*?(\\.\\.\\.|placeholder)[\\s\\S]*?}`, 'g');
                finalCode = finalCode.replace(regex, src.content);
                mergeCount++;
            }
        });

        document.getElementById('output-final').value = finalCode;
        log(`Success! Merged ${mergeCount} blocks and resolved redundancies.`, "success");
    }

    function refactorLogic() {
        let code = document.getElementById('output-final').value || document.getElementById('input-master').value;
        if(!code) return log("No code found to refactor", "warn");

        log("Running Smart Refactor...", "info");
        
        // 1. Remove double negatives and simplify common patterns
        code = code.replace(/!!/g, ''); 
        // 2. Convert old function styles to arrow functions where safe (simplified)
        // 3. Strip console logs for production optimization
        const logCount = (code.match(/console\.log/g) || []).length;
        code = code.replace(/console\.log\(.*?\);?/g, '');
        
        // 4. Optimize loops: basic for to forEach/map suggestion
        const forCount = (code.match(/for\s*\(var/g) || []).length;
        code = code.replace(/for\s*\(var/g, 'for (let');

        document.getElementById('output-final').value = code;
        log(`Refactor complete: Cleaned ${logCount} logs and updated ${forCount} loop declarations.`, "success");
    }

    async function downloadProject() {
        const code = document.getElementById('output-final').value;
        if(!code) return log("Nothing to export!", "warn");

        const zip = new JSZip();
        const blocks = parseCode(code);
        
        log("Generating module ZIP...", "info");
        blocks.forEach(b => {
            zip.file(`${b.name}.js`, `export const ${b.name} = ${b.content}`);
        });
        zip.file("main_app.js", code);

        const content = await zip.generateAsync({type: "blob"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(content);
        a.download = "DevCompanion_Project.zip";
        a.click();
        log("Project ZIP downloaded.", "success");
    }

    function parseCode(text) {
        const blocks = [];
        const regex = /(?:function\s+([\w$]+)|(?:const|let|var)\s+([\w$]+)\s*=\s*(?:\([^)]*\)|[\w$]+)\s*=>|([\w$]+)\s*\(.*?\)\s*\{)\s*\{?([\s\S]*?(\n\}|\n\s*\}))/g;
        let m;
        while ((m = regex.exec(text)) !== null) {
            const name = m[1] || m[2] || m[3];
            const content = m[0];
            const isPlaceholder = /\.\.\.|placeholder/i.test(content);
            if(name) blocks.push({ name, content, isPlaceholder });
        }
        return blocks;
    }

    function clearAll() {
        if(confirm("Clear workspace?")) {
            document.querySelectorAll('textarea').forEach(t => t.value = '');
            log("Workspace cleared.");
        }
    }
</script>
</body>
</html>
